<!DOCTYPE html>
<html>
<head>
    <title>Don Onofre - Sistema de Pagamentos</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>üõí Don Onofre - Sistema de Pagamentos</h1>
    
    <h2>Produtos Dispon√≠veis:</h2>
    
    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
        <div style="border: 1px solid #ccc; padding: 20px; border-radius: 10px; width: 250px;">
            <h3>üçï Pizza Don Onofre</h3>
            <p>Deliciosa pizza artesanal</p>
            <p><strong>R$ 50,00</strong></p>
            <button onclick="buyProduct('Pizza Don Onofre', 50)" 
                    style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                Comprar
            </button>
        </div>
        
        <div style="border: 1px solid #ccc; padding: 20px; border-radius: 10px; width: 250px;">
            <h3>üçî Hamb√∫rguer Artesanal</h3>
            <p>Hamb√∫rguer com ingredientes premium</p>
            <p><strong>R$ 35,00</strong></p>
            <button onclick="buyProduct('Hamb√∫rguer Artesanal', 35)"
                    style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                Comprar
            </button>
        </div>
        
        <div style="border: 1px solid #ccc; padding: 20px; border-radius: 10px; width: 250px;">
            <h3>ü•§ Refrigerante</h3>
            <p>Refrigerante 500ml</p>
            <p><strong>R$ 8,00</strong></p>
            <button onclick="buyProduct('Refrigerante', 8)"
                    style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                Comprar
            </button>
        </div>
    </div>
    
    <div id="result" style="margin-top: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 10px; display: none; background: #f9f9f9;">
        <h3>Status do Pedido:</h3>
        <p id="status">Processando...</p>
        <a id="payment-link" href="#" target="_blank" 
           style="display: none; background: #2196F3; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px; margin-top: 10px;">
            Ir para Pagamento
        </a>
    </div>

    <script>
    function buyProduct(productName, amount) {
        const resultDiv = document.getElementById('result');
        const statusP = document.getElementById('status');
        const paymentLink = document.getElementById('payment-link');
        
        resultDiv.style.display = 'block';
        statusP.textContent = 'Criando pedido...';
        statusP.style.color = '#333';
        paymentLink.style.display = 'none';
        
        fetch('/api/orders/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                product_name: productName,
                amount: amount
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro na requisi√ß√£o: ' + response.status);
            }
            return response.json();
        })
        .then(data => {
            console.log('Pedido criado:', data);
            
            if (data.error) {
                statusP.textContent = 'Erro: ' + data.error;
                statusP.style.color = 'red';
                return;
            }
            
            if (data.warning) {
                statusP.innerHTML = `Pedido criado! ID: ${data.id}<br>
                                    <small style="color: orange;">‚ö†Ô∏è ${data.warning}</small>`;
            } else {
                statusP.innerHTML = `‚úÖ Pedido criado com sucesso!<br>
                                    <small>ID: ${data.id}</small>`;
            }
            
            if (data.payment_link) {
                paymentLink.href = data.payment_link;
                paymentLink.textContent = 'üëâ Ir para Pagamento AdamsPay';
                paymentLink.style.display = 'inline-block';
                
                // Adicionar bot√£o para ver status
                if (!document.getElementById('status-btn')) {
                    const statusBtn = document.createElement('button');
                    statusBtn.id = 'status-btn';
                    statusBtn.textContent = 'üîÑ Verificar Status';
                    statusBtn.style.marginLeft = '10px';
                    statusBtn.style.background = '#666';
                    statusBtn.style.color = 'white';
                    statusBtn.style.padding = '10px 15px';
                    statusBtn.style.border = 'none';
                    statusBtn.style.borderRadius = '5px';
                    statusBtn.style.cursor = 'pointer';
                    statusBtn.onclick = () => checkOrderStatus(data.id);
                    statusP.parentNode.appendChild(statusBtn);
                }
                
                // Redireciona automaticamente ap√≥s 5 segundos
                setTimeout(() => {
                    if (data.payment_link && !data.payment_link.includes('fallback')) {
                        window.location.href = data.payment_link;
                    }
                }, 5000);
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            statusP.textContent = 'Erro ao criar pedido: ' + error.message;
            statusP.style.color = 'red';
        });
    }

    function checkOrderStatus(orderId) {
        fetch(`/api/orders/${orderId}/`)
            .then(response => response.json())
            .then(data => {
                alert(`Status do pedido: ${data.status}`);
            })
            .catch(error => {
                console.error('Erro ao verificar status:', error);
            });
    }
    </script>
    
    <style>
    body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
    }
    h1 {
        color: #333;
        border-bottom: 2px solid #4CAF50;
        padding-bottom: 10px;
    }
    button:hover {
        opacity: 0.9;
        transform: translateY(-2px);
        transition: all 0.3s;
    }
    #result {
        max-width: 500px;
    }
    </style>
</body>
</html>